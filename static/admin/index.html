<!doctype html>
<html>

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="robots" content="noindex" />
    <title>Content Manager - Lerian Studio Blog</title>
    <link rel="icon" href="/images/lerian-logo.svg" type="image/svg+xml">
    <style>
        /* Ensure CMS is visible */
        body {
            margin: 0;
            padding: 0;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;
            background: #fff;
            overflow: auto !important;
        }

        /* Make sure CMS container is visible and on top */
        #nc-root,
        [data-slate-editor],
        .css-0,
        .cms-app {
            opacity: 1 !important;
            visibility: visible !important;
            display: block !important;
            position: relative !important;
            z-index: 9999 !important;
            background: white !important;
            min-height: 100vh !important;
        }

        /* Hide/fix authentication overlay issues */
        .auth-page,
        .login-page {
            z-index: 10000 !important;
            background: rgba(255, 255, 255, 0.95) !important;
            backdrop-filter: blur(2px);
        }

        /* Ensure main CMS interface appears above auth elements */
        [class*="cms"],
        [class*="CMS"],
        [id*="cms"],
        [id*="CMS"] {
            z-index: 9999 !important;
            position: relative !important;
        }

        /* Fix any potential iframe issues */
        iframe {
            z-index: 1 !important;
        }

        /* Fallback styling for hidden elements */
        * {
            max-width: none !important;
        }

        /* Loading indicator - higher z-index */
        .loading {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 18px;
            color: #666;
            z-index: 10001 !important;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        /* Force visibility on common CMS class patterns */
        [class*="nc-"],
        [class*="netlify"],
        [class*="decap"] {
            opacity: 1 !important;
            visibility: visible !important;
            z-index: 9999 !important;
        }

        /* Hide login button after authentication */
        .auth-success+* {
            display: none !important;
        }

        /* Hide login overlay after CMS loads */
        .login-page,
        .auth-page,
        [class*="login"],
        [class*="auth"] {
            display: none !important;
        }

        /* Aggressive login overlay removal */
        .login-page,
        .auth-page,
        [class*="login"],
        [class*="auth"],
        button[class*="login"],
        button[class*="auth"] {
            display: none !important;
            visibility: hidden !important;
            opacity: 0 !important;
            position: absolute !important;
            left: -9999px !important;
        }

        /* Force main content areas visible */
        [class*="app"],
        [class*="main"],
        [class*="content"],
        [class*="dashboard"] {
            display: block !important;
            visibility: visible !important;
            opacity: 1 !important;
        }
    </style>
</head>

<body>
    <div class="loading" id="loading">Loading CMS...</div>

    <!-- Decap CMS with manual initialization -->
    <script>
        window.CMS_MANUAL_INIT = true;
    </script>
    <script src="https://unpkg.com/decap-cms@^3.0.0/dist/decap-cms.js"></script>
    <script>
        console.log('🚀 Decap CMS loading with manual init...');

        // Initialize CMS with configuration
        CMS.init({
            config: {
                backend: {
                    name: 'github',
                    repo: 'LerianStudio/blog',
                    branch: 'main',
                    base_url: 'https://decap-oauth-vercel-omqwct67c-fred-amarals-projects.vercel.app',
                    auth_endpoint: 'api/auth'
                },
                load_config_file: false,
                publish_mode: 'editorial_workflow',
                media_folder: 'static/images/uploads',
                public_folder: '/images/uploads',
                site_url: 'https://blog.lerian.studio',
                display_url: 'https://blog.lerian.studio',
                logo_url: '/images/lerian-logo.svg',
                collections: [
                    {
                        name: 'posts',
                        label: 'Blog Posts',
                        folder: 'content/posts',
                        create: true,
                        slug: '{{slug}}',
                        fields: [
                            { label: 'Title', name: 'title', widget: 'string' },
                            { label: 'Slug', name: 'slug', widget: 'string' },
                            { label: 'Date', name: 'date', widget: 'datetime' },
                            { label: 'Draft', name: 'draft', widget: 'boolean', default: false },
                            { label: 'Featured Image', name: 'featured_image', widget: 'image', required: false },
                            { label: 'Featured Image Alt', name: 'featured_image_alt', widget: 'string', required: false },
                            { label: 'Featured Image Caption', name: 'featured_image_caption', widget: 'string', required: false },
                            {
                                label: 'Categories',
                                name: 'categories',
                                widget: 'select',
                                multiple: true,
                                options: ['Architecture', 'Financial Technology', 'Development', 'Product', 'API Design', 'Data Security']
                            },
                            {
                                label: 'Tags',
                                name: 'tags',
                                widget: 'select',
                                multiple: true,
                                options: ['fintech', 'architecture', 'cqrs', 'eda', 'ledger', 'midaz', 'sdk', 'api-design', 'software-architecture', 'crm', 'customer-management', 'data-security']
                            },
                            { label: 'Content', name: 'body', widget: 'markdown' }
                        ]
                    },
                    {
                        name: 'pages',
                        label: 'Pages',
                        files: [
                            {
                                label: 'About Page',
                                name: 'about',
                                file: 'content/about/_index.md',
                                fields: [
                                    { label: 'Title', name: 'title', widget: 'string' },
                                    { label: 'Date', name: 'date', widget: 'datetime', required: false },
                                    { label: 'Draft', name: 'draft', widget: 'boolean', default: false },
                                    { label: 'Content', name: 'body', widget: 'markdown' }
                                ]
                            }
                        ]
                    }
                ]
            }
        });

        console.log('✅ CMS initialized with manual config');

        // Ultra-aggressive login overlay removal
        function nukeLoginOverlay() {
            console.log('💥 NUKING login overlays...');

            // Remove ALL buttons containing login/github text
            document.querySelectorAll('button').forEach(btn => {
                const text = btn.textContent?.toLowerCase() || '';
                if (text.includes('login') || text.includes('github') || text.includes('sign in')) {
                    btn.remove();
                    console.log('🗑️ Removed login button:', text);
                }
            });

            // Remove any overlay containers
            const overlaySelectors = [
                '[class*="overlay"]',
                '[class*="modal"]',
                '[class*="login"]',
                '[class*="auth"]',
                '[role="dialog"]',
                '[aria-modal="true"]'
            ];

            overlaySelectors.forEach(selector => {
                document.querySelectorAll(selector).forEach(el => {
                    const content = el.textContent?.toLowerCase() || '';
                    if (content.includes('login') || content.includes('github')) {
                        el.remove();
                        console.log('🗑️ Removed overlay element');
                    }
                });
            });

            // Force show CMS main content
            const cmsRoot = document.querySelector('#nc-root');
            if (cmsRoot) {
                // Make absolutely everything visible
                cmsRoot.style.cssText = `
                    display: block !important;
                    visibility: visible !important;
                    opacity: 1 !important;
                    position: relative !important;
                    z-index: 9999 !important;
                    background: white !important;
                    min-height: 100vh !important;
                    width: 100% !important;
                `;

                // Force all descendants visible
                const allElements = cmsRoot.querySelectorAll('*');
                allElements.forEach(el => {
                    if (el.style) {
                        const computedStyle = window.getComputedStyle(el);
                        if (computedStyle.display === 'none' || computedStyle.visibility === 'hidden') {
                            el.style.cssText += `
                                display: block !important;
                                visibility: visible !important;
                                opacity: 1 !important;
                            `;
                        }
                    }
                });

                console.log('✅ CMS root and all children forced visible');
                console.log('📊 Total elements made visible:', allElements.length);
            }
        }

        // Start aggressive forcing immediately
        setTimeout(nukeLoginOverlay, 1000);

        // Continue aggressive forcing every 2 seconds
        setInterval(nukeLoginOverlay, 2000);

        // Listen for any authentication messages and nuke overlays
        window.addEventListener('message', (event) => {
            console.log('📨 Received message:', event.data);

            if (event.data && typeof event.data === 'string' && event.data.includes('authorization:github:success')) {
                console.log('🎉 GitHub authentication successful!');

                // Immediate nuke after auth
                setTimeout(nukeLoginOverlay, 100);
                setTimeout(nukeLoginOverlay, 500);
                setTimeout(nukeLoginOverlay, 1000);
            }
        });

        // Also nuke on any click events (user interaction)
        document.addEventListener('click', () => {
            setTimeout(nukeLoginOverlay, 100);
        });

        // Status check
        setTimeout(() => {
            console.log('📊 Final CMS status:');
            const cmsRoot = document.querySelector('#nc-root');
            if (cmsRoot) {
                console.log('- CMS children:', cmsRoot.children.length);
                console.log('- CMS display:', window.getComputedStyle(cmsRoot).display);
                console.log('- CMS visibility:', window.getComputedStyle(cmsRoot).visibility);

                // Final aggressive nuke
                nukeLoginOverlay();
            }
        }, 5000);
    </script>
</body>

</html>