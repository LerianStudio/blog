{{ if or (.Page.Store.Get "hasMermaid") .Params.mermaid }}
<script src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script>
<script>
  document.addEventListener('DOMContentLoaded', () => {
    // Detect if dark mode is enabled
    const isDarkMode = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
    
    // Set theme based on color scheme
    const theme = isDarkMode ? 'dark' : 'default';
    
    // Initialize Mermaid with custom settings
    mermaid.initialize({
      startOnLoad: true,
      theme: theme,
      securityLevel: 'loose',
      flowchart: { 
        useMaxWidth: true, 
        htmlLabels: true,
        curve: 'basis'
      },
      // Custom theme variables to match hugo-dead-simple theme
      themeVariables: {
        // Common settings
        primaryColor: isDarkMode ? '#3b82f6' : '#3b82f6',
        primaryTextColor: isDarkMode ? '#f1f5f9' : '#334155',
        primaryBorderColor: isDarkMode ? '#475569' : '#cbd5e1',
        lineColor: isDarkMode ? '#64748b' : '#94a3b8',
        secondaryColor: isDarkMode ? '#1e293b' : '#f1f5f9',
        tertiaryColor: isDarkMode ? '#0f172a' : '#ffffff',
        
        // Background colors
        mainBkg: isDarkMode ? '#1e293b' : '#ffffff',
        secondBkg: isDarkMode ? '#334155' : '#f8fafc',
        
        // Font settings to match theme
        fontSize: '16px',
        fontFamily: 'system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif'
      },
      // Diagram-specific settings
      sequence: {
        useMaxWidth: true,
        boxMargin: 10,
        mirrorActors: false
      },
      gantt: {
        leftPadding: 75,
        rightPadding: 20
      }
    });
    
    // Listen for color scheme changes
    window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', event => {
      location.reload();
    });
  });
</script>

<style>
  /* Additional styling for Mermaid diagrams */
  .mermaid {
    margin: 1.5rem 0;
    overflow-x: auto;
    text-align: center;
    border-radius: 0.375rem;
    padding: 1rem;
    background-color: var(--background, #f8fafc);
  }
  
  @media (prefers-color-scheme: dark) {
    .mermaid {
      background-color: var(--background, #1e293b);
    }
  }
</style>
{{ end }}
